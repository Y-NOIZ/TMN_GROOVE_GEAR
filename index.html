<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>TMN Live Gear</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <style>
    table.dataTable thead th {
      text-align: center;
    }
    .live-logo {
      width: 48px;
      height: 48px;
      object-fit: contain;
      cursor: pointer;
      transition: opacity 0.3s;
    }
    .live-logo:not(.active) {
      opacity: 0.3;
    }
    td備考 {
      text-align: left;
    }
  </style>
</head>
<body>

<table id="gearTable" class="display" style="width:100%">
  <thead>
    <tr>
      <th>ジャンル</th>
      <th>メーカー</th>
      <th>機材名</th>
      <th>
        <img src="logos/RRTT.svg" class="live-logo live-filter active" data-live="RHYTHM RED TMN TOUR">
      </th>
      <th>
        <img src="logos/TTE.svg" class="live-logo live-filter active" data-live="TOUR TMN EXPO">
      </th>
      <th>
        <img src="logos/C4U.svg" class="live-logo live-filter active" data-live="TOUR TMN EXPO FINAL CRAZY 4 YOU">
      </th>
      <th>
        <img src="logos/LG.svg" class="live-logo live-filter active" data-live="TMN 4001 DAYS GROOVE">
      </th>
      <th>備考</th>
    </tr>
  </thead>
</table>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
$(document).ready(function() {
  const liveColumnIndexMap = {
    "RHYTHM RED TMN TOUR": 3,
    "TOUR TMN EXPO": 4,
    "TOUR TMN EXPO FINAL CRAZY 4 YOU": 5,
    "TMN 4001 DAYS GROOVE": 6
  };

  const table = $('#gearTable').DataTable({
    paging: false,
    info: false,
    ajax: {
      url: 'TMN_GROOVE_GEAR.csv',
      dataSrc: function(csv) {
        const lines = csv.split('\n').filter(line => line.trim() !== '');
        const headers = lines[0].split(',');
        return lines.slice(1).map(line => {
          const cols = line.split(',');
          return {
            ジャンル: cols[0],
            メーカー: cols[1],
            機材名: cols[2],
            RHYTHM: cols[3],
            EXPO: cols[4],
            CRAZY: cols[5],
            GROOVE: cols[6],
            備考: cols[7]
          };
        });
      }
    },
    columns: [
      { data: 'ジャンル' },
      { data: 'メーカー' },
      { data: '機材名' },
      { data: 'RHYTHM', className: 'dt-center' },
      { data: 'EXPO', className: 'dt-center' },
      { data: 'CRAZY', className: 'dt-center' },
      { data: 'GROOVE', className: 'dt-center' },
      { data: '備考', className: 'dt-left' }
    ],
    order: []
  });

  $('.live-logo').on('click', function() {
    $(this).toggleClass('active');
    table.draw();
  });

  $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
    const activeLives = $('.live-logo.active').map(function() {
      return $(this).data('live');
    }).get();

    if (activeLives.length === 0) return true;

    return activeLives.every(live => {
      const colIndex = liveColumnIndexMap[live];
      return data[colIndex] === '✓';
    });
  });
});
</script>

</body>
</html>
