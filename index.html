<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>TMN GROOVE GEAR</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #filterContainer { margin-bottom: 20px; }
    .logo { width: 40px; height: 40px; opacity: 0.4; cursor: pointer; transition: opacity 0.3s; }
    .logo.active { opacity: 1; }
    th.logo-header { pointer-events: none; }
    .small-icons th { font-size: 0; }
    .small-icons th img { width: 30px; height: 30px; }
  </style>
</head>
<body>

<h1>TMN GROOVE GEAR</h1>
<div>
  <label><input type="checkbox" id="toggleView"> 縮小表示をオン</label>
</div>
<div id="filterContainer">
  <img src="RRTT.svg" id="filter-rrtt" class="logo" title="RHYTHM RED TMN TOUR">
  <img src="TTE.svg" id="filter-tte" class="logo" title="TOUR TMN EXPO">
  <img src="C4U.svg" id="filter-c4u" class="logo" title="TOUR TMN EXPO FINAL CRAZY 4 YOU">
  <img src="LG.svg" id="filter-lg" class="logo" title="TMN 4001 DAYS GROOVE">
</div>

<table id="gearTable" class="display" style="width:100%">
  <thead>
    <tr>
      <th>ジャンル</th>
      <th>メーカー</th>
      <th>機材名</th>
      <th class="logo-header">RHYTHM RED TMN TOUR</th>
      <th class="logo-header">TOUR TMN EXPO</th>
      <th class="logo-header">TOUR TMN EXPO FINAL CRAZY 4 YOU</th>
      <th class="logo-header">TMN 4001 DAYS GROOVE</th>
      <th>備考</th>
    </tr>
  </thead>
</table>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
$(document).ready(function() {
  let activeFilters = [];

  const table = $('#gearTable').DataTable({
    ajax: "TMN_GROOVE_GEAR.csv",
    columns: [
      { data: "ジャンル" },
      { data: "メーカー" },
      { data: "機材名" },
      { data: "RHYTHM RED TMN TOUR", orderable: false },
      { data: "TOUR TMN EXPO", orderable: false },
      { data: "TOUR TMN EXPO FINAL CRAZY 4 YOU", orderable: false },
      { data: "TMN 4001 DAYS GROOVE", orderable: false },
      { data: "備考" }
    ],
    paging: false,
    info: false,
    ordering: true,
    order: [],
    dom: 't',
    language: {
      emptyTable: "データがありません"
    },
    initComplete: function() {
      // フィルター初期化
      filterTable();
    },
    processing: true,
    serverSide: false,
    deferRender: true,
    columnDefs: [
      { targets: [3,4,5,6], className: 'dt-center' },
      { targets: 7, className: 'dt-left' }
    ],
    dataSrc: function (csv) {
      const lines = csv.split("\n");
      const headers = lines[0].split(",");
      return lines.slice(1).filter(line => line.trim() !== "").map(line => {
        const values = line.split(",");
        let obj = {};
        headers.forEach((h, i) => {
          obj[h] = values[i] || "";
        });
        return obj;
      });
    }
  });

  function filterTable() {
    $.fn.dataTable.ext.search = [];
    if (activeFilters.length > 0) {
      $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
        for (let i = 0; i < activeFilters.length; i++) {
          if (data[activeFilters[i]] !== '✓') {
            return false;
          }
        }
        return true;
      });
    }
    table.draw();
  }

  function toggleFilter(id, columnIndex) {
    const idx = activeFilters.indexOf(columnIndex);
    if (idx > -1) {
      activeFilters.splice(idx, 1);
      $(`#filter-${id}`).removeClass('active');
    } else {
      activeFilters.push(columnIndex);
      $(`#filter-${id}`).addClass('active');
    }
    filterTable();
  }

  $('#filter-rrtt').click(function() { toggleFilter('rrtt', 3); });
  $('#filter-tte').click(function() { toggleFilter('tte', 4); });
  $('#filter-c4u').click(function() { toggleFilter('c4u', 5); });
  $('#filter-lg').click(function() { toggleFilter('lg', 6); });

  $('#toggleView').change(function() {
    if ($(this).is(':checked')) {
      $('#gearTable').addClass('small-icons');
    } else {
      $('#gearTable').removeClass('small-icons');
    }
  });
});
</script>
</body>
</html>
